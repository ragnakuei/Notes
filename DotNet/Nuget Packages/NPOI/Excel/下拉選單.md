# 下拉選單

```csharp
private readonly NpoiExcelService _service;

public NpoiExcelController()
{
    _service = new NpoiExcelService();
}

[HttpGet, Route("A")]
public IHttpActionResult A()
{
    var excelFile = GenerateFilDTO();
    _service.GenerateExcel(excelFile);

    var fileStream = File.OpenRead(excelFile.FileNameWithPath);

    var response = new HttpResponseMessage(HttpStatusCode.OK);
    response.Content = new StreamContent(fileStream);
    response.Content.Headers.ContentType = new MediaTypeHeaderValue(excelFile.ContentType);
    response.Content.Headers.ContentDisposition = new ContentDispositionHeaderValue("attachment");
    response.Content.Headers.ContentDisposition.FileName = HttpUtility.UrlPathEncode(excelFile.FileName);
    response.Content.Headers.ContentLength = fileStream.Length;

    return ResponseMessage(response);
}

private static FileDTO GenerateFilDTO()
{
    var result = new FileDTO();
    result.FileName = "Sample.xlsx";
    result.ContentType = MimeMapping.GetMimeMapping(result.FileName);

    var siteRootPath = AppDomain.CurrentDomain.BaseDirectory;
    var filesFolderPath = Path.Combine(siteRootPath, "Files");
    result.FileNameWithPath = Path.Combine(filesFolderPath, result.FileName);
    return result;
}

public class NpoiExcelService
{
    public NpoiExcelService()
    {
    }

    internal void GenerateExcel(FileDTO excelDTO)
    {
        var workbook = new XSSFWorkbook();
        XSSFSheet sheet = (XSSFSheet)workbook.CreateSheet("sheet");

        var validationHelper = new XSSFDataValidationHelper(sheet);

        // 放到第 2 個 Column 第 3 個 Row (Base 0)
        var addressList = new CellRangeAddressList(1, 2, 1, 2);
        var constraint = validationHelper.CreateExplicitListConstraint(new String[] { "One", "Two", "Three", "Four" });
        var dataValidation = validationHelper.CreateValidation(constraint, addressList);
        dataValidation.SuppressDropDownArrow = true;
        sheet.AddValidationData(dataValidation);

        var fileStream = File.Create(excelDTO.FileNameWithPath);
        workbook.Write(fileStream);
        fileStream.Close();
    }
}

public class FileDTO
{
    public long FileStreamLength;
    public string ContentType { get; internal set; }
    public Stream FileStream { get; internal set; } = new MemoryStream();
    public string FileName { get; internal set; }
    public string FileNameWithPath { get; internal set; }
}

```
