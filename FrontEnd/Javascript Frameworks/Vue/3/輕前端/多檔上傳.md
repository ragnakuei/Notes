# 多檔上傳

```cs
@page 
@{ Layout = null; }
<div id="app">
    <form asp-antiforgery="true"
          v-on:submit.prevent="submit()">
        <input type="button"
               value="新增"
               v-on:click="new_file()" />

        <template v-for="(file, index) of files">
            <input type="file"
                   required
                   v-on:change="change_file($event, index)" />
        </template>

        <input type="submit"
               value="submit" />
    </form>
</div>

<script src="~/lib/jquery/dist/jquery.min.js"></script>
<script src="https://unpkg.com/vue@next"></script>
<script>
  const { createApp, ref, reactive } = Vue;

  const app = createApp({
    setup() {
      const files = ref([]);

      function new_file() {
        files.value.push({});
      }

      function change_file($event, index) {
        console.log('$event.target.files[0]',$event.target.files[0]);
        files.value[index] = $event.target.files[0];
      }

      function submit() {
        const form_data = new FormData();

        for (let i = 0; i < files.value.length; i++) {
          form_data.append("files", files.value[i]);
        }

        $.ajax({
          type: "POST",
          url: "?handler=Update",
          data: form_data,
          processData: false,
          contentType: false,
          beforeSend: function (xhr) {
            xhr.setRequestHeader("RequestVerificationToken", $('input:hidden[name="__RequestVerificationToken"]').val());
          },
          success: function (data) {
            alert("ok");
          },
        });
      }

      return {
        files, 
        new_file,
        change_file,
        submit,
      };
    },
  });

  const vm = app.mount("#app");
</script>

@functions
{
    public void OnGet()
    {
    }

    public IActionResult OnPostUpdate([FromForm] Dto dto)
    {
        return new JsonResult(dto.files.Count);
    }

    public class Dto
    {
        public IList<IFormFile> files { get; set; }
    }
}
```