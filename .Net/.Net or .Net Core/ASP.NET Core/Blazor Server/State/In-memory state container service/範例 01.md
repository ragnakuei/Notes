# 範例 01

共用狀態 Model

-   TestScopedModel.cs

    ```cs
    public class TestScopedModel
    {
        private string _value;

        public string Value
        {
            get => _value;
            set
            {
                _value = value;
                OnChange?.Invoke();
            }
        }

        public event Action? OnChange;
    }
    ```

-   註冊至 DI Container 中

    - Model 不會以 Singleton 或 Transient 的方式註冊
      - Singleton - 跨 Session / Request 的共用狀態
      - Transient - 每個 DI 的狀態都不同 ! 可以直接改用 new Model() 的方式就可以了 !
    - Scoped 才會是該次 Request 建立連線時，所共用的狀態

    ```cs
    services.AddScoped<TestScopedModel>();
    ```

共用 razor component

-   Test.razor

    此 component 被引用的地方，都會及時更新狀態

    ```cs
    @implements IDisposable

    <p>Test</p>

    <input @bind-value=TestScopedModel.Value />

    <label>@TestScopedModel.Value</label>

    @code {
        [Inject]
        public TestScopedModel TestScopedModel { get; set; }

        protected override void OnInitialized()
        {
            TestScopedModel.OnChange += StateHasChanged;
        }

        public void Dispose()
        {
            TestScopedModel.OnChange -= StateHasChanged;
        }
    }

    ```

更改狀態的 component

-   T1.razor

    ```cs
    @page "/T1"

    <p>T1</p>

    <input @bind-value=TestScopedModel.Value />

    <label>@TestScopedModel.Value</label>

    @code {
        [Inject]
        public TestScopedModel TestScopedModel { get; set; }
    }
    ```

假設 Test.razor 放在 MainLayout.razor 中
而 T1.razor 為其某一個子頁面的 component
當 T1.razor 更新 TestScopedModel.Value 時
就會透過 OnChange event => StateHasChanged 來立即更新 Test.razor 內的資料
