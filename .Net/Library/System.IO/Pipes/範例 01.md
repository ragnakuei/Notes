# 範例 01


Server

```cs
var pipeName = "mypipe";

// 建立命名管道伺服器
using (var pipeServer = new NamedPipeServerStream(pipeName))
{
	Console.WriteLine("等待客戶端連線...");

	// 等待客戶端連線
	await pipeServer.WaitForConnectionAsync();

	Console.WriteLine("客戶端已連線！");

	try
	{
		// 傳送訊息給客戶端
		string message = "歡迎使用命名管道！";
		byte[] messageBytes = Encoding.UTF8.GetBytes(message);
		await pipeServer.WriteAsync(messageBytes, 0, messageBytes.Length);

		while (pipeServer.IsConnected)
		{
			// 接收客戶端傳來的訊息
			byte[] buffer = new byte[1024];
			int bytesRead = await pipeServer.ReadAsync(buffer, 0, buffer.Length);
			string receivedMessage = Encoding.UTF8.GetString(buffer, 0, bytesRead);
			Console.WriteLine($"接收到客戶端訊息：{receivedMessage}");
		} 
	}
	catch (IOException ex)
	{
		Console.WriteLine($"發生錯誤：{ex.Message}");
	}

	if(pipeServer.IsConnected == false)
	{
		Console.WriteLine("客戶端已斷線！");
	}

	// 結束連線並關閉管道
	pipeServer.Disconnect();
	pipeServer.Close();
}

Console.WriteLine("伺服器已關閉。");
```

Client

```cs
var pipeName = "mypipe";

// 建立命名管道客戶端
using (var pipeClient = new NamedPipeClientStream(".", pipeName, PipeDirection.InOut))
{
	Console.WriteLine("正在嘗試連線到伺服器...");

	// 嘗試連線到伺服器
	await pipeClient.ConnectAsync();

	Console.WriteLine("已連線到伺服器！");

	try
	{
		// 接收伺服器傳來的訊息
		var buffer = new byte[1024];
		var bytesRead = await pipeClient.ReadAsync(buffer, 0, buffer.Length);
		var receivedMessage = Encoding.UTF8.GetString(buffer, 0, bytesRead);
		Console.WriteLine($"接收到伺服器訊息：{receivedMessage}");

		Console.WriteLine("輸入要傳給伺服器的訊息，按下 Enter 進行傳送，或直接按下 Enter 離開。");
		
		while (pipeClient.IsConnected)
		{
			var sendMessage = Console.ReadLine();

			if (string.IsNullOrEmpty(sendMessage))
			{
				break;
			}

			var sendMessageBytes = Encoding.UTF8.GetBytes(sendMessage);
			await pipeClient.WriteAsync(sendMessageBytes, 0, sendMessageBytes.Length);
		}
	}
	catch (IOException ex)
	{
		Console.WriteLine($"發生錯誤：{ex.Message}");
	}

	// 結束連線並關閉管道
	pipeClient.Close();
}

Console.WriteLine("已關閉客戶端。");
```