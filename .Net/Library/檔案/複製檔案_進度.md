# 複製檔案_進度

```cs
async Task Main()
{
	var sourceFile = @"C:\temp\temp.zip";
	var targetFile = @"C:\temp\temp-target.zip";

	await CopyFileAsync(sourceFile, targetFile);
}

public async Task CopyFileAsync(string sourceFileName, string targetFileName)
{
	// 取得檔案資訊
	var sourceFile = new FileInfo(sourceFileName);

	// 建立讀取串流
	using (var sourceStream = sourceFile.OpenRead())
	{
		// buffer size = 1MB
		var buffer = new byte[1024 * 1024];
		var totalBytesRead = 0L;
		var bytesRead = 0;
		var previousProgress = 0;

		// 建立寫入串流
		using (var targetStream = new FileStream(targetFileName, FileMode.Create))
		{
			// 逐步從來源串流讀取資料並寫入到目標串流
			while ((bytesRead = await sourceStream.ReadAsync(buffer, 0, buffer.Length)) > 0)
			{
				await targetStream.WriteAsync(buffer, 0, bytesRead);
				totalBytesRead += bytesRead;

				// 計算複製進度
				var progress = (int)((totalBytesRead * 100) / sourceStream.Length);
				// 可以將進度資訊回傳給前端或做其他處理

				if (previousProgress != progress)
				{
					Console.WriteLine($"Progress: {progress}%");
					previousProgress = progress;
				}


				// 執行一些非寫入相關的工作
				// TODO
			}
		}
	}

	// 儲存完成後執行其他操作
	Console.WriteLine("Copy completed");
}
```