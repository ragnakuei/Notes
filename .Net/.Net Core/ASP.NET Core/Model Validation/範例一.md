# 範例一

## Dto 定義

```csharp
public class TestDto
{
    [Display(Name = "編號")]
    [Required(ErrorMessage    = "沒填是要怎麼抓資料")]
    [Range(1, 5, ErrorMessage = "{0} 數值 要介於 {1} 及 {2} 之間")]
    public int? Id { get; set; }

    [Display(Name = "名稱")]
    [DataType(DataType.Text)]
    [Required(ErrorMessage         = "必填喔")]
    [StringLength(5, MinimumLength = 2, ErrorMessage = "{0} 長度 要介於 {2} 及 {1} 之間")]
    public string Name { get; set; }

    [Display(Name = "電子信箱")]
    [DataType(DataType.EmailAddress)]
    [Required(ErrorMessage     = "必填喔")]
    [EmailAddress(ErrorMessage = "為何不填 Email 格式")]
    public string Email { get; set; }
}
```

## Action 範例

此範例把 驗証結果 放到 `TempData["ValidMessage"]` 中，可視情況調整 !

```csharp
[HttpPost]
[ValidateAntiForgeryToken]
public IActionResult Index(TestDto dto)
{
    if (ModelState.IsValid == false)
    {
        TempData["ValidMessage"] = JsonSerializer.Serialize(ModelState.ToDictionary().ReplaceKeyToDisplayName<TestDto>());
        return View(dto);
    }

    TempData["ValidMessage"] = "驗証成功";
    return RedirectToAction("Index");
}
```

## Helpers 範例

```csharp
public static class ModelStateHelper
{
    public static Dictionary<string, List<string>> ToDictionary(this ModelStateDictionary m)
    {
        var result = new Dictionary<string, List<string>>();

        if (m.IsValid)
        {
            return result;
        }

        foreach (var keyValuePair in m)
        {
            result.Add(keyValuePair.Key, keyValuePair.Value.Errors.Select(e => e.ErrorMessage).ToList());
        }

        return result;
    }

    public static Dictionary<string, List<string>> ReplaceKeyToDisplayName<T>(this Dictionary<string, List<string>> dict)
    {
        var propertiesDisplayNames = typeof(T).GetProperties()
                                                .Select(p => new
                                                            {
                                                                PropertyName     = p.Name,
                                                                DisplayAttribute = p.GetCustomAttributes(typeof(DisplayAttribute), false)?.FirstOrDefault() as DisplayAttribute
                                                            })
                                                .ToDictionary(k => k.PropertyName, v => v.DisplayAttribute.Name);

        var result = dict.Select(kv =>
                                        new
                                        {
                                            NewKey = propertiesDisplayNames.GetValue(kv.Key),
                                            Value  = kv.Value,
                                        })
                            .ToDictionary(kv => kv.NewKey, kv => kv.Value);

        return result;
    }
}
```
